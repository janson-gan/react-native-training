# Learning Journal 25th - 27th May 2022
## Day 29-33: Tracker App (Continue from 24th May 2022)
### What I Learnt Today
#### Making API Request (Unsuccessful)
- Making a request for sign up.
- Dispatch an action to update state and send a error message to user.
- Display the error message in signup component. 
<img src="https://github.com/janson-gan/react-native-training/blob/main/images/Screenshot%202022-05-27%20at%2012.26.47%20PM.png" width="500" />

- Sign up successfully with token.
- If sign up with the same email, suppose to throw an error, but I was unable to console log the error.
- Instead of getting the response error, I get some html error message asking me to sign up.
<img src="https://github.com/janson-gan/react-native-training/blob/main/images/Screenshot%202022-05-27%20at%2012.41.41%20PM.png" width="500" />

```javascript
const signup = (dispatch) => {
  return async ({ email, password }) => {
    try {
      const response = await TrackerApi.post('/signup', { email, password });
      console.log(response.data);
    } catch (err) {
      console.log(err.message);
    }
  };
};
```
- But using Thunder to post the same email able to return the response error message.
<img src="https://github.com/janson-gan/react-native-training/blob/main/images/Screenshot%202022-05-27%20at%201.01.12%20PM.png" width="500" />

#### Async Storage / Storing The Token
- Set initial state value to <code>token: null</code>.
- By default no token means user not logged in, if null become jsonwebtoken means user had logged in.
- Using AsyncStorage to store user token <code>AsyncStorage.setItem('token', response.data.token);</code>.
#### Navigate From Outside Of React
- Navigating without the navigation prop.
- NavigationActions use by Udemy tutorial is from v4, for v6 use <code>[createNavigationContainerRef](https://reactnavigation.org/docs/navigating-without-navigation-prop/)</code>
#### Navigate To Track List Screen
<img src="https://github.com/janson-gan/react-native-training/blob/main/images/May-27-2022%2022-07-36.gif" width="200" />

#### Navigate To Sign In
<img src="https://github.com/janson-gan/react-native-training/blob/main/images/May-27-2022%2022-14-12.gif" width="200" />

#### Clearing Error Message
- As both sign in and sign up share the same state, the error message will still be display when navigate between screen.
<img src="https://github.com/janson-gan/react-native-training/blob/main/images/May-27-2022%2022-34-45.gif" width="200" />
- Create a new action function to clear the message <code>const clearErrorMessage = (dispatch) => dispatch({ type: 'clear_error_message' });</code>.
- NavigationEvents onWillBlur had depreciated, instead use <code>navigation.addEventListener</code> to clear the message in signup and signin component.

```javascript
useEffect(() => {
      const listener = navigation.addListener('focus', () => {
        clearErrorMessage();
      });
      return listener;
    }, [navigation]);
```
<img src="https://github.com/janson-gan/react-native-training/blob/main/images/May-28-2022%2010-00-20.gif" width="200" />

#### Automatic Sign In
- When app start chceck for any token in AsyncStorage.
- If yes, navigate to track list, otherwise navigate to sign up or sign in screen.
- Create a new action function to check is there are any token store in AsyncStorage.
- If there is dispatch an action with that token.
#### Empty Screens While Resolving Auth
- To prevent showing the sign up screen in split second before displaying the track list screen.
- Create another loading screen to replace the sign up screen during the authenticating duration, and set it to initial route at the stack navigator.

```javascript
  <Stack.Navigator initialRouteName='ResolveAuthScreen'>
     <Stack.Screen 
      name="ResolveAuthScreen" 
      component={ResolveAuthScreen} 
      options={{ header: () => null }} // to clear the header bar
    />
```
<img src="https://github.com/janson-gan/react-native-training/blob/main/images/May-28-2022%2012-11-42.gif" width="200" />

#### Signing Out A User
- Remove user token when sign out button is click <code>await AsyncStorage.removeItem('token');</code>.
- Navigate back to Auth screen.
<img src="https://github.com/janson-gan/react-native-training/blob/main/images/May-28-2022%2014-13-32.gif" width="200" />

#### Installing A Map
- <code>[npm install react-native-maps](https://www.npmjs.com/package/react-native-maps)</code>
- use MapView tag and set style height to 300 to display map in component.
- To get default country location, set the initial region attribute coordinates.

```javascript
  <MapView 
    style={styles.map}
    initialRegion={{
        latitude: 1.402808914817191,
        longitude: 103.91427206880874,
        latitudeDelta: 0.01,
        longitudeDelta: 0.01
    }}
```
<img src="https://github.com/janson-gan/react-native-training/blob/main/images/Screenshot%202022-05-28%20at%205.18.21%20PM.png" width="200" />

#### Reading A Location.
- Under ios simulator features, set location to city run to fake a location.
#### Creating a Location Context
- To store current location, location and recording state.
- Pass the Provider to App.tsx

```javascript
<LocationProvider>
  <AuthProvider>
    <NavigationContainer ref={navigationRef}>
     <RootStack/>
    </NavigationContainer>
  </AuthProvider>
</LocationProvider>
```

#### Live Location Updates

